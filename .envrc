#!/usr/bin/env bash
# ^ added for shellcheck and file-type detection

# Watch & reload direnv on change
# watch_file devshell.toml

# if [[ $(type -t use_flake) != function ]]; then
#   echo "ERROR: use_flake function missing."
#   echo "Please update direnv to v2.30.0 or later."
#   exit 1
# fi
# use flake
# eval "$(lorri direnv)"
layout_poetry() {
  if [[ ! -f pyproject.toml ]]; then
    log_error 'No pyproject.toml found. Use `poetry new` or `poetry init` to create one first.'
    exit 2
  fi

  # create venv if it doesn't exist
  export POETRY_CACHE_DIR=/workspaces/greenflow/.vscode/.poetry.cache
  export POETRY_VIRTUALENVS_IN_PROJECT=true
  poetry run true

  export VIRTUAL_ENV=$(poetry env info --path)
  export POETRY_ACTIVE=1
  PATH_add "$VIRTUAL_ENV/bin"
}
layout_poetry
